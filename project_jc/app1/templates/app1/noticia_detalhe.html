{% extends 'app1/base.html' %}
{% load static %}

{% block content %}

<link rel="stylesheet" href="{% static 'app1/css/noticia_detalhe.css' %}">

<div class="noticia-page container">
    
    <header class="mb-4">
        <h1>{{ noticia.titulo }}</h1>
        <div class="d-flex justify-content-between align-items-center">
            <span class="text-muted">Publicado em: {{ noticia.data_publicacao|date:"d/m/Y H:i" }}</span>
            
            <form action="{% url 'app1:favoritar_noticia_view' noticia.pk %}" method="POST" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn {% if is_favorita %}btn-danger{% else %}btn-outline-primary{% endif %} btn-sm">
                    {% if is_favorita %}
                        <i class="bi bi-heart-fill"></i> Remover dos Favoritos
                    {% else %}
                        <i class="bi bi-heart"></i> Adicionar aos Favoritos
                    {% endif %}
                </button>
            </form>
        </div>
    </header>

    <hr>

    <div class="controles-fonte mb-3">
        <strong>Acessibilidade:</strong>
        <button id="diminuir-fonte" class="btn btn-sm btn-light border" title="Diminuir Fonte (A-)">A-</button>
        <button id="aumentar-fonte" class="btn btn-sm btn-light border" title="Aumentar Fonte (A+)">A+</button>
    </div>

    <article id="corpo-noticia" class="mb-5">
        {{ noticia.conteudo|linebreaks }}
    </article>

    <hr>

    <section class="comentarios-section mt-5">
        <h3>Comentários ({{ comentarios.count }})</h3>

        <div class="lista-comentarios mb-4">
            {% for comentario in comentarios %}
                <div class="card mb-2">
                    <div class="card-body p-3">
                        <h6 class="card-subtitle mb-2 text-muted d-flex justify-content-between">
                            <span><strong>{{ comentario.usuario.username }}</strong> disse:</span>
                            <small>{{ comentario.data_comentario|date:"d/m/Y H:i" }}</small>
                        </h6>
                        <p class="card-text">{{ comentario.texto }}</p>
                    </div>
                </div>
            {% empty %}
                <p class="text-muted">Nenhum comentário ainda. Seja o primeiro a participar!</p>
            {% endfor %}
        </div>

        <div class="novo-comentario p-3 bg-light rounded">
            {% if user.is_authenticated %}
                <h4>Deixe seu comentário</h4>
                <form action="{% url 'app1:adicionar_comentario' noticia.pk %}" method="POST">
                    {% csrf_token %}
                    <div class="mb-3">
                        {{ form_comentario.texto }} </div>
                    <button type="submit" class="btn btn-primary">Enviar Comentário</button>
                </form>
            {% else %}
                <div class="text-center">
                    <p class="mb-2">Você precisa estar logado para comentar.</p>
                    <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-outline-primary">Fazer Login</a>
                </div>
            {% endif %}
        </div>
    </section>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const btnAumentar = document.getElementById('aumentar-fonte');
        const btnDiminuir = document.getElementById('diminuir-fonte');
        const corpoNoticia = document.getElementById('corpo-noticia');

        const TAMANHO_MINIMO = 12; 
        const TAMANHO_MAXIMO = 32; 
        const INCREMENTO = 2;      

        function getTamanhoAtual() {
            const estilo = window.getComputedStyle(corpoNoticia, null).getPropertyValue('font-size');
            return parseFloat(estilo);
        }

        function setTamanhoFonte(novoTamanho) {
            corpoNoticia.style.fontSize = novoTamanho + 'px';
        }

        btnAumentar.addEventListener('click', () => {
            let tamanhoAtual = getTamanhoAtual();
            if (tamanhoAtual < TAMANHO_MAXIMO) {
                let novoTamanho = tamanhoAtual + INCREMENTO;
                setTamanhoFonte(novoTamanho);
            }
        });

        btnDiminuir.addEventListener('click', () => {
            let tamanhoAtual = getTamanhoAtual();
            if (tamanhoAtual > TAMANHO_MINIMO) {
                let novoTamanho = tamanhoAtual - INCREMENTO;
                setTamanhoFonte(novoTamanho);
            }
        });
    });
</script>

{% endblock %}